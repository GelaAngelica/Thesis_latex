% !TEX root = /Users/Gela/Desktop/Thesis_latex/thesis.tex
\section{Simulations}
When performing the simulations in Simscape the main objective was to isolate the characteristics of the membrane functionally. The temperature dependencies in flow and pressure were expected to be implemented in the model. In order to receive good results, equations from DOW, the manufacturer of the membrane, were used. The results from the simulations showed that the membrane behaviour meets the constraints from theory. One important parameter is the temperature correction factor, plotted in figure \ref{fig:tcf}. It is used to compensate for the differences in temperature for the membrane performance, both in flow, pressure and conductivity and give the model some realistic behaviour in different temperatures. \\
\\
The simulations in Simscape showed realistic results on the membrane behaviour, the simulations could be used to determine how the real system would behave but more iterative work would be required to get more precise numerical values. The flow characteristics over the membrane, due to changes in temperature, meets the expectations from the theory. Pressure characteristics, seen in figure \ref{fig:deltap} is a bit high, which probably is due to the pump and pipes simulated in the model. \\
\\


\section{System behaviour} 

%The test setup was built to understand how the performance of the reverse osmosis changed while operating in different conditions and by analysis the logs from the tests it was possible to understand the complexity of this multiple input and output system. Testing was mostly carried out by fixing all parameters but one and then change this parameter and log how the system behaved, this proved to be difficult because some parameters, for instance recirculation flow and feed pressure were directly connected to each other. However, analysis of the log files from the tests it was possible to understand how different conditions and setups affected the behaviour of the system. 

The main purpose of this thesis was to investigate the advantages of using a two-pump system instead of the current one pump system. We found that there were multiple advantages of using the two-pump system, the overall power consumption and noise levels could be reduced without reducing permeate quality or water efficiency. The new setup also had the unforeseen advantage of reducing the pressure drop over the membrane, from feed to reject side. This was a result of changing the position of the inlet pump from inside of the recirculation loop to pumping straight into the loop and using the recirculation pump to create the desired flow. The reduced pressure drop causes the membrane to be more evenly pressurized, creating a more uniform permeate flux accross the membrane surface, this could in theory prevent the uneven scaling of the membrane.\\
\\
Initially, it was believed that a higher recirculation flow would improve the performance of the membrane by increasing the flow rate over the membrane surface and thereby causing a more turbulent flow that would mix high salinity water close to the membrane with less saline water further from the membrane. However, tests showed that this was not the case. The performance did improve by a small amount, but by increasing the recirculation flow, the pressure was also increased and the small improvements that could be observed was more likely caused by the increased pressure on feed side, not the increased flow rate from feed to reject side. Therefore, it was concluded that there was a no possibility of effectively optimize the membrane by increasing the recirculation flow. \\
\\
According to the membrane manufacturer the recovery rate should not exceed 20 \% in order to ensure the longevity of the membrane. It was decided to use the recirculation pump to ensure that the recovery remained fixed at 20\% and not use this parameter for optimization.\\
\\
Feed pressure has a direct effect on both permeate flow and salt rejection. The physical reason for the improved salt rejection is that a larger volume of water passes through the membrane surface and dilutes the dissolved salts that also passes. This can be seen in figure \ref{fig:FeedPumpIncrease40}, from this data it can also be concluded that salt rejection does not increase linearly with increased pressure and that the positive effect of an increased feed pressure is greater at low pressure, for instance an increase from 2 to 4 bar has a larger positive effect than an increase from 7 to 9 bar. As a result, improving the performance of the membrane has low cost at low pressures but becomes more and more expensive when the pressure increases.\\
\\
Hot water has lower viscosity than cold water and also a higher diffusion rate than cold water. The pores of the membrane are also expanding at higher temperatures, causing a higher flow through the membrane from feed to product side. Consequently, higher temperatures cause higher permeate flow over the membrane and increased salt passage through the membrane surface. If both water and salt passage were equaly affected by temperature the rejection rate would not change with changing temperature but high temperatures makes it easier for salts to pass through the membrane surface than water, resulting in a larger flow of water that contains a proportionally larger amount of dissolved salts. In order to improve the salt rejection rate more permeate needs to pass through the surface to dilute the salts and this can be achieved by increasing feed side pressure, causing a higher flow. \\
\\
The conductivity of the inlet water is also a quantity that depends on the tap water and determines the lowest possible conductivity of the recirculation loop. By using permeate conductivity as a set point for controlling the drain valve it is possible to optimize the water efficiency of the system and ensure high quality permeate water. Lower conductivity feed water allows the system to recirculate more water without reaching the critical limit where a permeate conductivity of 30  can not be maintained. Therefore, the system can adapt to different feed water conductivity by adjusting the drain valve.\\
\\
Net driving pressure depends on the feed pressure in the recirculation loop, permeate side pressure and also the osmotic pressure caused by the different salt concentrations across the membrane. In order to save energy, it is beneficial to have a low permeate side pressure and lower conductivity in the recirculation loop. In order to save water, the control loop controlling the drain valve accumulate high conductivity water in the recirculation loop which increases NDP, net driving pressure. However, this drawback is necessary to maintain a high water efficiency and in the authors opinion, the slight decrease in NDP is worth the increase in efficiency. It is possible to increase the feed side pressure by increasing the pump speed, although, this requires more energy. The only way to improve the NDP of a system without decreasing water efficiency or increasing energy is to decrease the permeate side pressure. This can be done by selecting components on permeate side with a low pressure drop and by using a short flow path.

\section{One vs two pump system}

In the one pump system, the feed pump creates both flow and pressure and these parameter are therefore coupled to each other and cannot be changed independently. The pressure is generated by the resistance in the membrane and also in the recirculation restrictor. As a result, the feed pump must deliver a large amount of water to build the pressure needed to push the water through the membrane surface. \\
\\
By changing the flow path and adding another pump the feed pump can pressurize the circulation loop without a high water flow. As a result, the feed pump can run at a much lower rpm. The circulation pump creates the flow but does not have to generate any pressure since the circulation loop is pressurized by the feed pump.

\section{Fine tuning}

The PID parameters for the controllers could be changed at runtime in the simulink real time GUI and the PID parameters that were used was found by trial and error. We found that the recirculation, and permeate flow controller could be fast without causing problems. The drain valve controller on the other hand needed to be very slow to not cause oscillations. \\
\\
Little effort was made to try to find the best possbile PID parameters for the control loops. Since the pumps or the drain valve most likely would be changed if there were any further development on the two pump system we choose not to spend time trying to make the system as fast and stable as possible and instead focus on the algorithm. \\
\\
\section{Control System Design}

There were two main properties that was to be optimized, water efficiency and energy consumption. The conductivity of the permeate water should also be controlled.\\
\\
A PI controller was used to control the conductivity of the permeate by opening or closing the drain valve. Salt rejection changes with different temperatures and feed pressure, because of this, the recirculation loop can only hold a certain amount of dissolved salts in order to maintain a permeate of 30 \SI{}{\micro\siemens}/cm. For instance, if the system has a salt rejection of 99\% the recirculation loop must hold water with a conductivity of 3000 \SI{}{\micro\siemens}/cm to obtain a 30 \SI{}{\micro\siemens}/cm permeate. If the system saltrejection change to 96\% then the conductivity in the recirculation loop must be 750 \SI{}{\micro\siemens}/cm to achieve the same permeate quality. As can be seen in figure \ref{fig:Permeatecond} from the tests with the current system, a system with room temperatured inlet water was able to maintain 30 \SI{}{\micro\siemens}/cm permeate water with 2500 \SI{}{\micro\siemens}/cm in the recirculation loop but if the inlet water was heated to 40 degrees Celsius only 1500 \SI{}{\micro\siemens}/cm recirculation conductivity was needed to reach 30 \SI{}{\micro\siemens}/cm. Thereby, controlling the valve position was critical to being able to make sure that the permeate conductivity was 30 \SI{}{\micro\siemens}/cm regardless of operating conditions. \\
\\
Opening the drain valve lowers the conductivity in the recirculation loop but it takes time to reach a new steady state. This caused a problem because if the changes were not slow the system would overshoot. The only way to fix this problem was to use a slower controller.\\
\\
%Since the recirculation loop and the membrane contains about TBD liters of water the response from changing the drain valve was slow, much longer than the other control loops which has an almost immediate effect. Because of this it was necessary for the controller to slow. 
An increase in pressure resulted in more fluid getting pushed out of the drain valve without the position of the valve being changed. As a result, changes in pressure will act as a disturbance on this control loop. To counter the effect of this, the valve needs to close to make sure that no water is unnecessarily being rejected to drain. However, closing the valve will result in an increased pressure in the system that needs to be handled by the controller controlling the pressure in the system. This means that these two controllers are coupled to each other and that it is impossible to change one without influencing the other. Because pressure can be changed quickly, this problem could be fixed by using a much faster controller for the controller controlling the feed pressure pump than the drain valve.\\
\\
Tests showed that increased recovery did not affect the salt rejection of the system. For this reason, it was decided to set the recovery setpoint to approximately 20 \% which was the recommended recovery from the membrane manufacturer. This regulator had little impact on the regulator controlling the drain valve but when the flow in the recirculation loop increase so does the pressure in the loop. The effect of this can be seen in figure \ref{fig:RecIncrease40}. From the plots it can be seen that 22 \% recovery caused a pressure of 5.5 bars and a recovery of 14 \% increased the pressure to 7 bars. Therefore, the regulator pressurizing the recirculation loop act as a disturbance on the recovery regulator.\\
\\
The last controller was the controller tasked with optimizing the membrane. Warmer inlet temperature increases the amount of salts that pass through the membrane as well as the water. However, the increased temperature increases the salt passage more than the passage of water, resulting in a higher permeate flow with a higher conductivity. The only way to counter this phenomenon and increase salt rejection is to increase the permeate flow by increasing feed pressure and dilute the increased salt in the increased permeate flow. By using the formula to convert feed water temperature to a set point for the permeate flow the salt rejection of the membrane could be optimized. This design allows the system to counter the detrimental effect that increased temperature has on the salt rejection of the membrane at the cost of using more energy. The increased salt rejection allows higher conductivity water to be accumulated into the recirculation loop and thereby water efficiency is increased. In figure \ref{fig:SaltRejectionResult} it can be seen that increasing feed pressure has a larger positive effect on salt rejection when the inlet temperature was high and therefor there is no need to waste energy running the system at high pressure. In this scenario, it is better to save energy by running the system at lower pressure and permeate flow. \\
\\
The system was designed to be able to deliver a stream of permeate water with a conductivity of 30 \SI{}{\micro\siemens}/cm without using more energy and rejected water than necessary, but our tests showed that the only way to increase salt rejection and lower the amount of rejected water was to increase the permeate flow. This means that there is a trade-off between water efficiency and energy efficiency. Running the system on low pressure decreases salt rejection and thereby less salts can be recirculated back into the recirculation loop and this means that more water is wasted. By testing, the lowest permeate flow that generated a permeate conductivity of 30 \SI{}{\micro\siemens}/cm at different temperatures could be found and these results were translated into a function for what permeate flow should be used as a set point at different temperatures. 

\section{Noise reduction}

An additional positive effect of using two pumps instead of one was that there was a significant reduction in noise. Since this effect was not a part of the initial scope and just a positive side effect of using two pumps no data was gathered to support the claim, but the difference could be heard when both systems were tested. The reason for the noise reduction was that both the two pumps were running at much lower rpms when using two pumps. 

\section{Reduced pump size}
When using the two pump system the pump speeds varied from 3\% to 25\% depending on the permeate flow setpoint which is a reduction from the 60 \% and 80 \% used when one pump was used. This indicate that it might be possible to use smaller pumps. Smaller pumps could allow the system to be smaller and they are often cheaper than larger pumps. This reduction of the prize could reduce the increased cost of buying two pumps instead of one. Smaller pumps might also be more quiet.

\section{Membrane size}
Membrane size determines the permeate flux at a certain pressure and for smaller systems it might be beneficial to reduce the size of the membrane to make the device smaller and possibly cheaper. In addition to the reduced size and prize a smaller membrane has less pressure drop and more even pressure over the whole membrane.

\section{Membrane identification method}
This report is based on the DOW FilmTec membrane used by Baxter today and the temperature to optimal permeate flow function will only work for this membrane. However, the method for finding this function can be used on any membrane. By following the method outlined in this report this function can be found for any other reverse osmosis membrane and can be modified for other specifications on permeate quality. 

\section{Scaling}
One advantage of using a permeate flow set point for the feed pump controller is that it will let the system adapt to scaling. When scaling occur, the membrane surface becomes coated with suspended solids that clogs the surface of the membrane. Using the control design from this thesis, when the membrane surface clogs up more pressure is needed to reach the permeate flow setpoint and this will automatically be achieved by increasing the feed pump. Membrane fouling is inevitable and eventually the membrane will have to be replaced. Even though membrane fouling can't be stopped it can be minimized by following the operational guidelines from the membrane manufacturer. One of these guidelines is the maximum allowed recovery and by controlling this parameter with a control loop, the system improves the longevity of the membrane. 

\section{Drain valve}
The valve used in the test rig was built for much larger systems and is not intended for fine tuning. This caused problems because it was not possible to make small changes and this caused oscillations in the conductivity of the permeate. Because it was clear what caused the oscillation and that it would take a lot of time to find, order and rebuilt the test rig with a new valve we choose to continue using the valve. If there are any further development of the system, the valve should be replaced.\\
\\